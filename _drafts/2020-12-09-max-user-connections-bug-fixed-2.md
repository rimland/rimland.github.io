---
layout: post
title:  "ä»å¼‚å¸¸åˆ°68åˆ†é’Ÿåˆ°8åˆ†é’Ÿï¼ˆè®° RDS MySQL çš„ä¸€ä¸ªå¤§å‘ä¹‹åè®°ï¼‰"
date:   2020-12-08 00:05:00 +0800
categories: blog
published: true
---

åœ¨ [ã€Šè®° RDS MySQL çš„ä¸€ä¸ªå¤§å‘ã€‹](https://ittranslator.cn/blog/2020/12/07/max-user-connections-bug-fixed.html) ä¸­ï¼Œæˆ‘æåˆ°é‡åˆ° <font color="red">User juxxxxxxxxxx already has more than 'max_user_connections' active connectionsâ€¦â€¦</font> è¿™æ ·çš„é”™è¯¯ï¼Œæœ€ç»ˆé€šè¿‡åœ¨å¾ªç¯ä¸­ä½¿ç”¨ `Thread.Sleep`ï¼Œé™ä½ CRUD æ“ä½œçš„é¢‘ç‡ï¼Œè®©è¿æ¥æ•°ä¸‹é™è‡³ä¸åˆ°åŸæ¥çš„ä¸€åŠï¼Œä»è€Œè§£å†³äº†è¿™ä¸ªæ£˜æ‰‹çš„é—®é¢˜ï¼Œæœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥[ç‚¹å‡»é“¾æ¥å›é¡¾ä¸€ä¸‹](https://ittranslator.cn/blog/2020/12/07/max-user-connections-bug-fixed.html)ã€‚

æ˜¨æ—¥åœ¨[åšå®¢å›­ä¸­å‘å‡ºæ­¤æ–‡](https://www.cnblogs.com/ittranslator/p/14094449.html)åï¼Œæœ‰çƒ­å¿ƒçš„æœ‹å‹ï¼ˆ[@æ²ˆèµŸ](https://www.cnblogs.com/ittranslator/p/14094449.html#4766142)ï¼Œ[@ä¸çŸ¥é“é£å¾€å“ªå„¿å¹](https://www.cnblogs.com/ittranslator/p/14094449.html#4766160)ï¼‰å¯¹æ­¤é—®é¢˜æå‡ºäº†å®è´µçš„æ„è§å’Œæƒ³æ³•ï¼Œæ¿€å‘äº†æˆ‘å¯¹æ­¤é—®é¢˜ç»§ç»­æ·±ç©¶çš„å¿µå¤´ã€‚

ä¸‹åˆç»è¿‡å‡ ä¸ªå°æ—¶çš„åˆ†æå’Œæµ‹è¯•ï¼Œç»ˆäºæ‰¾åˆ°äº†è¯¥é—®é¢˜çš„çœŸæ­£åŸå› å’Œè§£å†³æ–¹æ³•ï¼Œåœ¨æ­¤åšä¸ªè¡¥å……ã€‚

**çœŸæ­£çš„åŸå› åœ¨äºï¼šä½¿ç”¨ MySQL å®˜æ–¹æä¾›çš„ MySql.Data ä½œä¸ºé©±åŠ¨ç¨‹åºè¿æ¥ MySQL æ•°æ®åº“çš„æ—¶å€™ï¼Œé»˜è®¤ä½¿ç”¨äº†è¿æ¥æ± ï¼Œæ‰å¼•å‘äº†è¿™ä¸ªé—®é¢˜**ã€‚é”™æ€ªäº†*é˜¿é‡Œäº‘ï¼ˆä¸Šç¯‡ä¸­æåˆ°æ€€ç–‘é˜¿é‡Œäº‘æ”¹äº† MySQL åº•å±‚åšäº†é™åˆ¶ï¼‰*ï¼Œåœ¨æ­¤å¯¹è‡ªå·±çš„ä¸ä¸¥è°¨è¡¨ç¤ºè¯šæ³çš„é“æ­‰ğŸ˜¥ğŸ˜¥ğŸ˜¥ï¼Œå‡¡äº‹è¦è‡ªå·±å¤šæ€è€ƒå¤šç ”ç©¶å¤šæ±‚è¯ï¼Œä¸å¯è½»æ˜“æ€€ç–‘æƒå¨çš„åŠ›é‡ï¼ï¼ï¼

ä¸‹é¢è¿›å…¥æœ¬æ–‡çš„æ­£é¢˜ï¼ŒèŠä¸€èŠè¯¥é—®é¢˜å‡ºç°çš„çœŸæ­£åŸå› å’Œè§£å†³åŠæ³•ã€‚

## MySQL è¿æ¥æ± 

æ ¹æ® [å®˜æ–¹ä»‹ç»](https://dev.mysql.com/doc/connector-net/en/connector-net-connections-pooling.html)ï¼šMySQL Connector/NETï¼ˆå³ MySql.Dataï¼‰è¿æ¥æ± çš„å·¥ä½œçš„æœºåˆ¶æ˜¯ï¼Œå½“å®¢æˆ·ç«¯é…ç½® MySqlConnection æ—¶ï¼Œè¿æ¥æ± é€šè¿‡ä¿æŒä¸€ç»„ä¸æœåŠ¡å™¨çš„æœ¬åœ°è¿æ¥ä½¿å…¶å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚éšåï¼Œå¦‚æœæ‰“å¼€ä¸€ä¸ªæ–°çš„ MySqlConnection å¯¹è±¡ï¼Œå®ƒå°†ä»è¿æ¥æ± ä¸­åˆ›å»ºè¿æ¥ï¼Œè€Œä¸æ˜¯é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„æœ¬æœºè¿æ¥ã€‚è¿™æ ·ä¾¿å¯ä»¥é‡ç”¨æ•°æ®åº“è¿æ¥ï¼Œé¿å…äº†é¢‘ç¹åˆ›å»ºã€é‡Šæ”¾è¿æ¥å¼•èµ·çš„å¤§é‡æ€§èƒ½å¼€é”€ï¼Œè¿™æœ‰åŠ©äºç¼©çŸ­å“åº”é€Ÿåº¦ã€ç»Ÿä¸€ç®¡ç†ã€æé«˜è¿è¡Œæ€§èƒ½ç­‰ç­‰ã€‚

åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ•°æ®åº“è¿æ¥éƒ½æœ‰é‡ç”¨çš„å¯èƒ½ï¼Œå³ä¾¿æ°¸ä¸é‡ç”¨ï¼Œè¿æ¥æ± ä¹Ÿæœ‰è‡ªå·±çš„å›æ”¶æœºåˆ¶åœ¨é€‚å½“çš„æ—¶å€™é‡Šæ”¾èµ„æºï¼Œè¿™æœ‰ç‚¹åƒå¸¦æœ‰è¿‡æœŸæ—¶é—´çš„ç¼“å­˜æ•°æ®ï¼Œä¹Ÿåƒ .NET çš„ GC å›æ”¶æœºåˆ¶ã€‚æ­£å› ä¸ºåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå®ƒå¯ä»¥æé«˜è¿è¡Œçš„æ€§èƒ½ï¼Œä¹Ÿæœ‰å®Œå–„ä¸”å¯é…ç½®çš„å›æ”¶æœºåˆ¶ã€‚æ‰€ä»¥åœ¨æ²¡æœ‰æä¾›è¿æ¥æ± é€‰é¡¹çš„æƒ…å†µï¼ŒMySQL Connector/NET é»˜è®¤

```sql
server=xxx;port=3306;userid=myuserid;password=pwd123;database=db125;charset=utf8;Pooling=false;
```


MySQL Connector/NETæ”¯æŒè¿æ¥æ± ï¼Œä»¥ä¾¿åœ¨æ•°æ®åº“å¯†é›†å‹åº”ç”¨ç¨‹åºä¸­è·å¾—æ›´å¥½çš„æ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§ã€‚

æ•°æ®åº“è¿æ¥æ± ï¼ˆConnection poolingï¼‰æ˜¯ç¨‹åºå¯åŠ¨æ—¶å»ºç«‹è¶³å¤Ÿçš„æ•°æ®åº“è¿æ¥ï¼Œå¹¶å°†è¿™äº›è¿æ¥ç»„æˆä¸€ä¸ªè¿æ¥æ± ï¼Œç”±ç¨‹åºåŠ¨æ€åœ°å¯¹æ± ä¸­çš„è¿æ¥è¿›è¡Œç”³è¯·ï¼Œä½¿ç”¨ï¼Œé‡Šæ”¾ã€‚

https://dev.mysql.com/doc/connector-net/en/connector-net-8-0-connection-options.html#connector-net-8-0-connection-options-classic-pooling

https://dev.mysql.com/doc/connector-net/en/connector-net-connections-pooling.html

https://dev.mysql.com/doc/connector-net/en/connector-net-connections-pooling.html

èµ„æºé‡ç”¨
      ç”±äºæ•°æ®åº“è¿æ¥å¾—åˆ°é‡ç”¨ï¼Œé¿å…äº†é¢‘ç¹åˆ›å»ºã€é‡Šæ”¾è¿æ¥å¼•èµ·çš„å¤§é‡æ€§èƒ½å¼€é”€ã€‚åœ¨å‡å°‘ç³»ç»Ÿæ¶ˆè€—çš„åŸºç¡€ä¸Šï¼Œå¦ä¸€æ–¹é¢ä¹Ÿå¢è¿›äº†ç³»ç»Ÿè¿è¡Œç¯å¢ƒçš„å¹³ç¨³æ€§ï¼ˆå‡å°‘å†…å­˜ç¢ç‰‡ä»¥åŠæ•°æ®åº“ä¸´æ—¶è¿›ç¨‹/çº¿ç¨‹çš„æ•°é‡ï¼‰ã€‚

 æ›´å¿«çš„ç³»ç»Ÿå“åº”é€Ÿåº¦
       æ•°æ®åº“è¿æ¥æ± åœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œå¾€å¾€å·²ç»åˆ›å»ºäº†è‹¥å¹²æ•°æ®åº“è¿æ¥ç½®äºæ± ä¸­å¤‡ç”¨ã€‚æ­¤æ—¶è¿æ¥çš„åˆå§‹åŒ–å·¥ä½œå‡å·²å®Œæˆã€‚å¯¹äºä¸šåŠ¡è¯·æ±‚å¤„ç†è€Œè¨€ï¼Œç›´æ¥åˆ©ç”¨ç°æœ‰å¯ç”¨è¿æ¥ï¼Œé¿å…äº†æ•°æ®åº“è¿æ¥åˆå§‹åŒ–å’Œé‡Šæ”¾è¿‡ç¨‹çš„æ—¶é—´å¼€é”€ï¼Œä»è€Œç¼©å‡äº†ç³»ç»Ÿæ•´ä½“å“åº”æ—¶é—´ã€‚

ç»Ÿä¸€çš„è¿æ¥ç®¡ç†ï¼Œé¿å…æ•°æ®åº“è¿æ¥æ³„æ¼
      åœ¨è¾ƒä¸ºå®Œå¤‡çš„æ•°æ®åº“è¿æ¥æ± å®ç°ä¸­ï¼Œå¯æ ¹æ®é¢„å…ˆçš„è¿æ¥å ç”¨è¶…æ—¶è®¾å®šï¼Œå¼ºåˆ¶æ”¶å›è¢«å ç”¨è¿æ¥ã€‚ä»è€Œé¿å…äº†å¸¸è§„æ•°æ®åº“è¿æ¥æ“ä½œä¸­å¯èƒ½å‡ºç°çš„èµ„æºæ³„æ¼ã€‚ä¸€ä¸ªæœ€å°åŒ–çš„æ•°æ®åº“è¿æ¥æ± å®ç°ï¼š


> ä½œè€… ï¼š æŠ€æœ¯è¯‘æ°‘  
> å‡ºå“ ï¼š [æŠ€æœ¯è¯‘ç«™](https://ittranslator.cn/)
