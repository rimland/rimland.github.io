---
layout: post
title:  "Task 执行顺序"
date:   2020-08-10 01:30:00 +0800
categories: backend docker
published: false
---

```csharp
class Program
{
    static void Main(string[] args)
    {
        Console.WriteLine("Thread in Main 1.");

        var task = RunAsync();

        Console.WriteLine("Thread in Main 2.");
        
        Console.ReadLine();
    }

    public static async Task RunAsync()
    {
        Console.WriteLine("Thread in RunAsync 1.");
        await Task.Factory.StartNew(() =>
        {
            Task.Factory.StartNew(() =>
            {
                Thread.Sleep(8000);
                Console.WriteLine("Thread by Task.Factory.StartNew 1, TaskCreationOptions.AttachedToParent");
            }, TaskCreationOptions.AttachedToParent);

            Task.Factory.StartNew(() =>
            {
                Thread.Sleep(8000);
                Console.WriteLine("Thread by Task.Factory.StartNew 2, TaskCreationOptions.None");
            }, TaskCreationOptions.None);

            Task.Factory.StartNew(() =>
            {
                Thread.Sleep(8000);
                Console.WriteLine("Thread by Task.Factory.StartNew 3, Empty");
            });

            Task.Factory.StartNew(() =>
            {
                Thread.Sleep(8000);
                Console.WriteLine("Thread by Task.Factory.StartNew 4, TaskCreationOptions.LongRunning");
            }, TaskCreationOptions.LongRunning);

            Parallel.For(1, 10, (i) =>
            {
                Thread.Sleep(3000);
                Console.WriteLine($"Thread {i}, start with Parallel.For.");
            });
        });
        Console.WriteLine("Thread in RunAsync 2.");
    }
}
```

执行结果：

```csharp
/*
Thread in Main 1.
Thread in RunAsync 1.
Thread in Main 2.
Thread 1, start with Parallel.For.
Thread 2, start with Parallel.For.
Thread 3, start with Parallel.For.
Thread 4, start with Parallel.For.
Thread 5, start with Parallel.For.
Thread 6, start with Parallel.For.
Thread 7, start with Parallel.For.
Thread 8, start with Parallel.For.
Thread 9, start with Parallel.For.
Thread by Task.Factory.StartNew 1, TaskCreationOptions.AttachedToParent
Thread in RunAsync 2.
Thread by Task.Factory.StartNew 2, TaskCreationOptions.None
Thread by Task.Factory.StartNew 3, Empty
Thread by Task.Factory.StartNew 4, TaskCreationOptions.LongRunning
*/
```

