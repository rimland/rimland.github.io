---
layout: post
title:  "C# 中的数字分隔符 _"
date:   2020-11-17 00:10:00 +0800
categories: dotnet csharp
published: false
---

编写 C# 代码时，我们时常会用到很大的数字，例如下面定义的变量：

```csharp
const long loops = 50000000000;
```

您能快速读出这是多少吗？是不是还是会有很多人把光标定位到最后一位，然后按键盘上的向左键一个一个往上数：个、十、百、千、万、十万、百万、千万、亿、十亿、百亿、千亿……

![reading large number](/assets/images/202011/large-numeric-literals.png#center)
<!-- ![reading large number](https://img2020.cnblogs.com/blog/2074831/202011/2074831-20201116020622863-863232680.png#center) -->

数字的这种写法，严重影响了它的可读性。所以人们才会发明了诸如千分位之类的写法，上面的数字用千分位可以写作 `50,000,000,000`，这样子是不是可读性就强多了？不过这是西方人的写法。  
如果按照我们中国人的习惯，可以写成 `500,0000,0000`，是不是一眼就可以读出来是*五百亿*了？

那么问题来了，我们能不能在代码中这么写来增强数字的可读性呢？  
答案是肯定的，不过要稍作改变 —— 把逗号换成下划线 `_`：

```csharp
const long loops = 500_0000_0000;
// 或者
const long loops = 50_000_000_000;
```

这是从 C# 7.0 开始支持的功能。它的用法和 Java 及 Python 中的用法是类似的。

当我们使用下划线 `_` 作为数字分隔符时，可以把它添加在数字文本中*除了第一个字符和最后一个字符之外*的任何位置。将下划线添加到长数字的不同的位置，就形成了不同的分组，不同的分组在不同的情景中可能会有不同的意义。比如我们在使用十进制、十六进制或二进制记数法声明数字时，可以加上下划线 `_` 字符，使数字更易读懂。

我们来举个例子，定义下面一组数字：

```csharp
int bin = 0b1001_1010_0001_0100;// 二进制表示
int hex = 0x64_95_ED;           // 十六进制表示
int dec1 = 1_000_000;           // 十进制
int dec2 = 100_0000;            // 十进制
int weird = 1_2__3___4____5_____6______7_______8________9;
double real = 1_000.111_1e-5;
decimal d = 1_222_345M;
```

上面的这些数字声明编译之后实际运行的代码是：

```csharp
int bin = 39444;
int hex = 6591981;
int dec1 = 1000000;
int dec2 = 1000000;
int weird = 123456789;
double real = 0.010001111;
decimal d = 1222345m;
```

可以看出，虽然表示结果一样，但是适当地添加了下划线分隔符的写法，大大增加了我们读数的容易程度。

*C# 中的任意数字都可以使用下划线分隔，两个连续数字字符之间允许出现多个下划线。* 但是有些时候是要注意的，比如在小数和指数中使用时，不能出现在小数点（10_.0）的前后、指数字符（1.1e_1）的前后和类型说明符（10_f）的前面，等等……

我们来看一些错误的用例，下面的用法都是错误的：

```csharp
double d1 = 1.1_e1;     //不能出现在指数字符前后
float f1 = 10_f;        //不能出现在类型说明符前面
double d2 = 10_.0;      //不能出现在小数点前后
float pi1 = 3_.1415F;   //不能出现在小数点前后
float pi2 = 3._1415F;   //不能出现在小数点前后
int x1 = 52_;           //不能出现在第一个字符和最后一个字符
int x2 = 0x52_;         //不能出现在第一个字符和最后一个字符
int x3 = 0_x52;         //不能出现在 0x 之间
```

## 总结

在定义较大的数字时，使用下划线 `_` 作为分隔符，可以让较长的数字更具可读性。这个功能虽然很微不足道，但当你用到它的时候，易读性会让你的心情好很多。

下划线分隔符在语义上对运行没有任何影响，它在编译的时候就被编译器忽略了。

<br />

> 作者 ： 技术译民  
> 出品 ： [技术译站](https://ittranslator.cn/)
